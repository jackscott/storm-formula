#!jinja|yaml
# Licensed to the Apache Software Foundation (ASF) under one
# or more contributor license agreements.  See the NOTICE file
# distributed with this work for additional information
# regarding copyright ownership.  The ASF licenses this file
# to you under the Apache License, Version 2.0 (the
# "License"); you may not use this file except in compliance
# with the License.  You may obtain a copy of the License at
#
# http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

# This file is generated by saltstack
# DO NOT EDIT!!  Any changes will be overwritten
{%- from "storm/map.jinja" import storm, meta with context %}
{%- set nimbus_host = salt['mine.get']('roles:storm_nimbus', 'network.ip_addrs', expr_form='grain').values() %}
{%- set zk_hosts = salt['mine.get']('roles:zookeeper', 'network.ip_addrs', expr_form='grain').values() %}

{%- for k,v in config.items() %}
{{ k }}: {{ v }}
{% endfor -%}

topology.debug: {{ storm.debug|default('true') }}

{%- set port = storm.get("supervisor_start_port", 6700) %}
supervisor.slots.ports:
  {%- for i in range(1, storm.get('supervisor_slots', 4)) %}
  - {{ port + i }}
  {%- endfor -%}

{% if nimbus_host %}
nimbus.seeds: [ {{ nimbus_host|map('first')|join(',') }} ]
{% endif %}

{% if zk_hosts %}
storm.zookeeper.servers: [ {{ zk_hosts|map('first')|join(',') }} ]

{% endif %}
