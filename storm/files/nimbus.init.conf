
# apache storm nimbus upstart

description "apache storm nimbus"

stop on runlevel [!2345]
console log
limit nofile 65535 65535

respawn
respawn limit 5 30

setuid {{ storm.user }}
setgid {{ storm.user }}

env INSTALL_DIR={{ meta['home'] }}
env LOCAL_CACHE=$INSTALL_DIR/storm-local
env JAVA_HOME={{ salt['grains.get']('java_home', salt['pillar.get']('java_home', '/usr/lib/java')) }}

start on net-device-up

pre-start script
  rm -rf $LOCAL_CACHE/nimbus/*
end script

script
  . /etc/default/nimbus
  if [ "x$ENABLE" = "xyes" ]; then
    exec {{ meta['home'] }}/bin/storm nimbus
  fi
end script
